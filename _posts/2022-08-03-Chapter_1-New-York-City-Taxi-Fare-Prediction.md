---
keywords: fastai
description: "In this first chapter, you will get exposure to the Kaggle competition process. You will train a model and prepare a csv file ready for submission. You will learn the difference between Public and Private test splits, and how to prevent overfitting."
title: Winning a Kaggle Competition in Python - Part 1
toc: true
branch: master
badges: true
comments: true
author: Hai Nguyen
categories: [Kaggle, Datacamp, Machine Learning, Python, EDA]
image: images/some_folder/your_image.png
hide: false
search_exclude: true
metadata_key1: metadata_value1
metadata_key2: metadata_value2
nb_path: _notebooks/Winning a Kaggle Competition in Python/2022-08-03-Chapter_1 New York City Taxi Fare Prediction.ipynb
layout: notebook
---

<!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/Winning a Kaggle Competition in Python/2022-08-03-Chapter_1 New York City Taxi Fare Prediction.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="1.1--Competitions-overview">1.1  Competitions overview<a class="anchor-link" href="#1.1--Competitions-overview"> </a></h1><ul>
<li>Explore train and test data</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Read train data</span>
<span class="n">taxi_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;datasets/taxi_train_chapter_4.csv&#39;</span><span class="p">)</span>
<span class="n">taxi_train</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;id&#39;,
 &#39;fare_amount&#39;,
 &#39;pickup_datetime&#39;,
 &#39;pickup_longitude&#39;,
 &#39;pickup_latitude&#39;,
 &#39;dropoff_longitude&#39;,
 &#39;dropoff_latitude&#39;,
 &#39;passenger_count&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="sd">&quot;&quot;&quot; &#39;fare_amount&#39; column is missing in test data because this is the column that we are predicting.&quot;&quot;&quot;</span>

<span class="c1"># Read test data</span>
<span class="n">taxi_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;datasets/taxi_test_chapter_4.csv&#39;</span><span class="p">)</span>
<span class="n">taxi_test</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;id&#39;,
 &#39;pickup_datetime&#39;,
 &#39;pickup_longitude&#39;,
 &#39;pickup_latitude&#39;,
 &#39;dropoff_longitude&#39;,
 &#39;dropoff_latitude&#39;,
 &#39;passenger_count&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">taxi_sample_sub</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;datasets/taxi_sample_submission.csv&#39;</span><span class="p">)</span>
<span class="n">taxi_sample_sub</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key</th>
      <th>fare_amount</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2015-01-27 13:08:24.0000002</td>
      <td>11.35</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2015-01-27 13:08:24.0000003</td>
      <td>11.35</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2011-10-08 11:53:44.0000002</td>
      <td>11.35</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2012-12-01 21:12:12.0000002</td>
      <td>11.35</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2012-12-01 21:12:12.0000003</td>
      <td>11.35</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="1.2-Train-XGBoost-models">1.2 Train XGBoost models<a class="anchor-link" href="#1.2-Train-XGBoost-models"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_full</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;datasets/train.csv&#39;</span><span class="p">)</span>
<span class="c1"># test = pd.read_csv(&#39;datasets/test.csv&#39;)</span>

<span class="c1"># Randomly use 30000 of your dataframe</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df_full</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">30000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>


<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>


<span class="kn">import</span> <span class="nn">xgboost</span> <span class="k">as</span> <span class="nn">xgb</span>

<span class="c1"># Create DMatrix on train data</span>
<span class="n">dtrain</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">DMatrix</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">train</span><span class="p">[[</span><span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="s1">&#39;item&#39;</span><span class="p">]],</span>
                     <span class="n">label</span><span class="o">=</span><span class="n">train</span><span class="p">[</span><span class="s1">&#39;sales&#39;</span><span class="p">])</span>
<span class="c1"># dtest = xgb.DMatrix(data=test[[&#39;store&#39;, &#39;item&#39;]])</span>


<span class="c1"># Define xgboost parameters</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>  <span class="s1">&#39;objective&#39;</span><span class="p">:</span> <span class="s1">&#39;reg:linear&#39;</span><span class="p">,</span>
            <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="c1"># &#39;max_depth&#39;: 8,</span>
            <span class="c1"># &#39;max_depth&#39;: 15,</span>
            <span class="s1">&#39;verbosity&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

<span class="c1"># Train xgboost model</span>
<span class="n">xg_depth_2</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">dtrain</span><span class="o">=</span><span class="n">dtrain</span><span class="p">)</span>


<span class="c1"># Define xgboost parameters</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>  <span class="s1">&#39;objective&#39;</span><span class="p">:</span> <span class="s1">&#39;reg:linear&#39;</span><span class="p">,</span>
            <span class="c1">#&#39;max_depth&#39;: 2,</span>
            <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
            <span class="c1"># &#39;max_depth&#39;: 15,</span>
            <span class="s1">&#39;verbosity&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

<span class="c1"># Train xgboost model</span>
<span class="n">xg_depth_8</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">dtrain</span><span class="o">=</span><span class="n">dtrain</span><span class="p">)</span>

<span class="c1"># Define xgboost parameters</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>  <span class="s1">&#39;objective&#39;</span><span class="p">:</span> <span class="s1">&#39;reg:linear&#39;</span><span class="p">,</span>
            <span class="c1">#&#39;max_depth&#39;: 2,</span>
            <span class="c1"># &#39;max_depth&#39;: 8,</span>
            <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
            <span class="s1">&#39;verbosity&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

<span class="c1"># Train xgboost model</span>
<span class="n">xg_depth_15</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">dtrain</span><span class="o">=</span><span class="n">dtrain</span><span class="p">)</span>

<span class="c1"># Define xgboost parameters</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>  <span class="s1">&#39;objective&#39;</span><span class="p">:</span> <span class="s1">&#39;reg:linear&#39;</span><span class="p">,</span>
            <span class="c1">#&#39;max_depth&#39;: 2,</span>
            <span class="c1"># &#39;max_depth&#39;: 8,</span>
            <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
            <span class="s1">&#39;verbosity&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

<span class="c1"># Train xgboost model</span>
<span class="n">xg_depth_30</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">dtrain</span><span class="o">=</span><span class="n">dtrain</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 30000 entries, 782526 to 499585
Data columns (total 4 columns):
 #   Column  Non-Null Count  Dtype 
---  ------  --------------  ----- 
 0   date    30000 non-null  object
 1   store   30000 non-null  int64 
 2   item    30000 non-null  int64 
 3   sales   30000 non-null  int64 
dtypes: int64(3), object(1)
memory usage: 1.1+ MB
None
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>c:\Users\nguyenngochai\.conda\envs\my_conda_env\lib\site-packages\xgboost\data.py:262: FutureWarning: pandas.Int64Index is deprecated and will be removed from pandas in a future version. Use pandas.Index with the appropriate dtype instead.
  elif isinstance(data.columns, (pd.Int64Index, pd.RangeIndex)):
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="1.3-Explore-overfitting-XGBoost">1.3 Explore overfitting XGBoost<a class="anchor-link" href="#1.3-Explore-overfitting-XGBoost"> </a></h1><p>Having trained 3 XGBoost models with different maximum depths, you will now evaluate their quality. For this purpose, you will measure the quality of each model on both the train data and the test data. As you know by now, the train data is the data models have been trained on. The test data is the next month sales data that models have never seen before.</p>
<p>The goal of this exercise is to determine whether any of the models trained is overfitting. To measure the quality of the models you will use Mean Squared Error (MSE). It's available in sklearn.metrics as mean_squared_error() function that takes two arguments: true values and predicted values.</p>
<p>train and test DataFrames together with 3 models trained (xg_depth_2, xg_depth_8, xg_depth_15) are available in your workspace.</p>
<ul>
<li><p>Instructions</p>
<ul>
<li>Make predictions for each model on both the train and test data.</li>
<li>Calculate the MSE between the true values and your predictions for both the train and test data.</li>
</ul>
</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>

<span class="n">dtrain_</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">DMatrix</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">train</span><span class="p">[[</span><span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="s1">&#39;item&#39;</span><span class="p">]])</span>
<span class="n">dtest</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">DMatrix</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">test</span><span class="p">[[</span><span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="s1">&#39;item&#39;</span><span class="p">]])</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">))</span>

<span class="c1"># For each of 3 trained models</span>
<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">[</span><span class="n">xg_depth_2</span><span class="p">,</span> <span class="n">xg_depth_8</span><span class="p">,</span> <span class="n">xg_depth_15</span><span class="p">,</span><span class="n">xg_depth_30</span><span class="p">]:</span>
    <span class="c1"># Make predictions</span>
    <span class="n">train_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">dtrain_</span><span class="p">)</span>     
    <span class="n">test_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">dtest</span><span class="p">)</span>          
    
    <span class="c1"># Calculate metrics</span>
    <span class="n">mse_train</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">train</span><span class="p">[</span><span class="s1">&#39;sales&#39;</span><span class="p">],</span> <span class="n">train_pred</span><span class="p">)</span>                  
    <span class="n">mse_test</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="s1">&#39;sales&#39;</span><span class="p">],</span> <span class="n">test_pred</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;MSE Train: </span><span class="si">{:.3f}</span><span class="s1">. MSE Test: </span><span class="si">{:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mse_train</span><span class="p">,</span> <span class="n">mse_test</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>15000 15000
MSE Train: 600.630. MSE Test: 601.486
MSE Train: 295.394. MSE Test: 301.276
MSE Train: 252.848. MSE Test: 263.355
MSE Train: 251.809. MSE Test: 262.937
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>c:\Users\nguyenngochai\.conda\envs\my_conda_env\lib\site-packages\xgboost\data.py:262: FutureWarning: pandas.Int64Index is deprecated and will be removed from pandas in a future version. Use pandas.Index with the appropriate dtype instead.
  elif isinstance(data.columns, (pd.Int64Index, pd.RangeIndex)):
c:\Users\nguyenngochai\.conda\envs\my_conda_env\lib\site-packages\xgboost\data.py:262: FutureWarning: pandas.Int64Index is deprecated and will be removed from pandas in a future version. Use pandas.Index with the appropriate dtype instead.
  elif isinstance(data.columns, (pd.Int64Index, pd.RangeIndex)):
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

